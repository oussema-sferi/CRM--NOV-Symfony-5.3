{% extends 'base.html.twig' %}

{% block title %}Edition Contact{% endblock %}

{% block body %}

    <div class="header pb-6" style="background-color: #EDA200">
        <div class="container-fluid">
            <div class="header-body">
                <div class="row align-items-center py-4">
                    <div class="col-lg-6 col-7">
                        <h6 class="h2 text-white d-inline-block mb-0">CRM</h6>
                        <nav aria-label="breadcrumb" class="d-none d-md-inline-block ml-md-4">
                            <ol class="breadcrumb breadcrumb-links breadcrumb-dark">
                                {% if not (is_granted('ROLE_COMMERCIAL')) %}
                                    <li class="breadcrumb-item"><i class="ni fas fa-address-book text-black-50"></i></li>
                                    <li class="breadcrumb-item">Gestion des contacts</li>
                                    <li class="breadcrumb-item"><a href="{{ path('all_contacts') }}">Liste des contacts</a></li>
                                {% else %}
                                    <li class="breadcrumb-item"><i class="fas fa-chalkboard-teacher text-yellow"></i></li>
                                    <li class="breadcrumb-item">Service Commercial</li>
                                    <li class="breadcrumb-item"><a href="{{ path('commercial_my_contacts') }}">Mes contacts</a></li>
                                {% endif %}
                                <li class="breadcrumb-item active" aria-current="page">Fiche contact</li>
                            </ol>
                        </nav>
                    </div>
                    <div class="col-lg-6 col-5 text-right">
                        {% if not (is_granted('ROLE_COMMERCIAL')) %}
                            <a href="{{ path('all_contacts') }}" class="btn btn-sm btn-neutral">Retour</a>
                        {% else %}
                            <a href="{{ path('commercial_my_contacts') }}" class="btn btn-sm btn-neutral">Retour</a>
                        {% endif %}
                    </div>
                </div>

            </div>
        </div>
    </div>
<!-- Page content -->
<div class="container-fluid mt--6">

        <div class="col-xl-12 order-xl-1">
            <div class="card">
                <div class="card-header">
                    <div class="row align-items-center">
                        <div class="col-8">
                            <h3 class="mb-0">Fiche Contact</h3>
                        </div>
                        {#<div class="col-4 text-right">
                            <a href="{{ path('all_contacts') }}" class="btn btn-sm btn-primary">Retour</a>
                        </div>#}
                    </div>
                </div>
                <div class="card-body">
                    <form action="{{ path('full_update_contact', {'id': client_to_update.id}) }}" method="post">
                        <h6 class="heading-small text-muted mb-4">Données Client</h6>
                        <div class="pl-lg-4">
                            <div class="row">
                                <div class="col-lg-6">
                                    <div class="form-group">
                                        {{ form_label(client_form.firstName, 'Prénom') }}
                                        {{ form_widget(client_form.firstName, {'attr': {'class': 'form-control', 'value': client_to_update.firstName }}) }}
                                    </div>
                                </div>
                                <div class="col-lg-6">
                                    <div class="form-group">
                                        {{ form_label(client_form.lastName, 'Nom') }}
                                        {{ form_widget(client_form.lastName, {'attr': {'class': 'form-control', 'value': client_to_update.lastName }}) }}
                                    </div>
                                </div>
                            </div>
                            <div class="row">

                                <div class="col-lg-6">
                                    <div class="form-group">
                                        {{ form_label(client_form.companyName, 'Société') }}
                                        {{ form_widget(client_form.companyName, {'attr': {'class': 'form-control', 'value': client_to_update.companyName }}) }}

                                    </div>
                                </div>

                                <div class="col-lg-6">
                                    <div class="form-group">
                                        {{ form_label(client_form.email, 'Email') }}
                                        {{ form_widget(client_form.email, {'attr': {'class': 'form-control', 'value': client_to_update.email }}) }}
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-lg-6">
                                    <div class="form-group">
                                        {{ form_label(client_form.address, 'Addresse') }}
                                        {{ form_widget(client_form.address, {'attr': {'class': 'form-control', 'value': client_to_update.address }}) }}
                                    </div>
                                </div>

                                <div class="col-lg-6">
                                    <div class="form-group">
                                        {{ form_label(client_form.postalCode, 'Code Postal') }}
                                        {{ form_widget(client_form.postalCode, {'attr': {'class': 'form-control', 'value': client_to_update.postalCode }}) }}
                                    </div>
                                </div>

                            </div>

                            <div class="row">
                                <div class="col-lg-6">
                                    <div class="form-group">
                                        {{ form_label(client_form.city, 'Catégorie') }}
                                        {{ form_widget(client_form.city, {'attr': {'class': 'form-control', 'value': client_to_update.city }}) }}
                                    </div>
                                </div>

                               {# <div class="col-lg-6">
                                    <div class="form-group">
                                        {{ form_label(client_form.postalCode, 'Code Postal') }}
                                        {{ form_widget(client_form.postalCode, {'attr': {'class': 'form-control', 'value': client_to_update.postalCode }}) }}
                                    </div>
                                </div>#}

                            </div>



                            <div class="row">
                                <div class="col-lg-6">
                                    <div class="form-group">
                                        {{ form_label(client_form.geographicArea, 'Département') }}
                                        {{ form_widget(client_form.geographicArea, {'attr': {'class': 'form-control'}}) }}
                                    </div>
                                </div>
                                <div class="col-lg-6">
                                    <div class="form-group">
                                        {{ form_label(client_form.country, 'Pays') }}
                                        {{ form_widget(client_form.country, {'attr': {'class': 'form-control', 'value': client_to_update.country }}) }}
                                    </div>
                                </div>

                            </div>

                            <div class="row">

                                <div class="col-lg-6">
                                    <div class="form-group">
                                        {{ form_label(client_form.phoneNumber, 'Numéro Domicile') }}
                                        {{ form_widget(client_form.phoneNumber, {'attr': {'class': 'form-control', 'value': client_to_update.phoneNumber }}) }}
                                    </div>
                                </div>
                                <div class="col-lg-6">
                                    <div class="form-group">
                                        {{ form_label(client_form.mobileNumber, 'Numéro Mobile') }}
                                        {{ form_widget(client_form.mobileNumber, {'attr': {'class': 'form-control', 'value': client_to_update.mobileNumber }}) }}
                                    </div>
                                </div>
                            </div>

                        </div>
                        <hr class="my-4" />
                        <!-- Address -->
                        <h6 class="heading-small text-muted mb-4">Données Utiles</h6>
                        <div class="pl-lg-4">

                            <div class="row">
                                <div class="col-lg-6">
                                    <div class="form-group">
                                        {{ form_label(client_form.category, 'Catégorie') }}
                                        {{ form_widget(client_form.category, {'attr': {'class': 'form-control', 'value': client_to_update.category }}) }}
                                    </div>
                                </div>
                                <div class="col-lg-6">
                                    <div class="form-group">
                                        {{ form_label(client_form.providedEquipment, 'Equipement') }}
                                        {{ form_widget(client_form.providedEquipment, {'attr': {'class': 'form-control', 'value': client_to_update.providedEquipment }}) }}
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-lg-6">
                                    <div class="form-group">
                                        {{ form_label(client_form.isUnderContract, 'Sous contrat') }}
                                        {{ form_widget(client_form.isUnderContract, {'attr': {'class': 'form-control', 'value': client_to_update.isUnderContract }}) }}
                                    </div>
                                </div>
                            </div>

                        </div>

                        {% if client_to_update.status != 0 %}
                            {% set calls_counter = 0 %}
                            <hr class="my-4" />

                            <h6 class="heading-small text-muted mb-4">Liste des Appels</h6>
                            {{ dump(client_form.calls) }}
                                    {% for call in client_form.calls %}
                                        {#{{ dump(client_form.calls) }}#}
                                        <div class="pl-lg-4">
                                        {% set calls_counter = calls_counter + 1 %}
                                            <h3 class="heading-small text-muted mb-4">Appel {{ calls_counter }}</h3>
                                                <div class="row">
                                                    <div class="col-lg-6">
                                                        {#<div class="form-group">
                                                            <label class="form-control-label" for="input-city">Etat</label>
                                                            <input type="text" id="input-city" class="form-control" value="{% if client_to_show.status == 0 %}Non traité{% elseif client_to_show.status == 1 %}Appel non qualifié{% else %}Appel qualifié{% endif %}" disabled>
                                                        </div>#}
                                                        {#<div class="form-group">
                                                            <label class="form-control-label" for="status">Etat</label>
                                                            #}{#<input type="text" id="input-status" class="form-control" value="{% if client_to_show.status == 0 %}Non traité{% elseif client_to_show.status == 1 %}Appel non qualifié{% else %}Appel qualifié{% endif %}" disabled>#}{#
                                                            <select name="status" id="status" class="form-control">
                                                                <option value="" selected>Choisir...</option>
                                                                <option value="1">Appel non Qualifié</option>
                                                                <option value="2">Appel Qualifié</option>
                                                            </select>
                                                        </div>#}
                                                        {#<div class="form-group">
                                                            {{ form_label(call.vars.value.generalStatus, 'Sous contrat') }}
                                                            {{ form_widget(call.vars.value.generalStatus, {'attr': {'class': 'form-control', 'value': 'hi' }}) }}
                                                        </div>#}
                                                    </div>
                                                    <div class="col-lg-6">
                                                        {#<div class="form-group">
                                                            <label class="form-control-label" for="input-country">Détails</label>
                                                            <input type="text" id="input-country" class="form-control" value="{% if client_to_update.statusDetail == 1 %}Ne répond pas{% elseif client_to_update.statusDetail == 2 %}Répondeur{% elseif client_to_update.statusDetail == 3 %}Barrage Secrétaire{% elseif client_to_update.statusDetail == 4 %}Pas Intéressé{% elseif client_to_update.statusDetail == 5 %}A Rappeler{% elseif client_to_update.statusDetail == 6 %}RDV à prendre{% elseif client_to_update.statusDetail == 7 %}RDV fixé {% else %}Non traité{% endif %}" disabled>
                                                        </div>#}
                                                        <div class="form-group">
                                                            <label class="form-control-label" for="status_details">Détails</label>
                                                            {#<input type="text" id="input-status" class="form-control" value="{% if client_to_show.status == 0 %}Non traité{% elseif client_to_show.status == 1 %}Appel non qualifié{% else %}Appel qualifié{% endif %}" disabled>#}
                                                            <select name="status_details" id="status_details" class="form-control">
                                                                <option value="" selected>Choisir...</option>
                                                                <option value="1">Ne répond pas</option>
                                                                <option value="2">Répondeur</option>
                                                                <option value="3">Barrage Secrétaire</option>
                                                                <option value="4">Pas Intéressé</option>
                                                                <option value="5">A Rappeler</option>
                                                                <option value="6">RDV à prendre</option>
                                                                <option value="7">RDV fixé</option>
                                                            </select>
                                                        </div>
                                                    </div>
                                                </div>
                                        </div>
                                    {#<hr class="my-4" />#}
                        <!-- Description -->

                        {#<h6 class="heading-small text-muted mb-4">Notes Appel</h6>#}
                                        <div class="pl-lg-4">
                                            {#<h3 class="heading-small text-muted mb-4">Notes Appel {{ calls_counter }}</h3>#}
                                            <div class="form-group">
                                                <label class="form-control-label">Notes</label>
                                                <textarea rows="4" class="form-control" placeholder="Pas de notes ..." resize="none">{#{{ call.vars.value.generalStatus }}#}</textarea>
                                            </div>
                                        </div>
                                    {% endfor %}
                        {% endif %}

                        {% if client_appointments_list|length > 0 %}
                        <hr class="my-4" />

                        <div class="row align-items-center py-4">
                            <div class="col-lg-6 col-7">
                                <h6 class="heading-small text-muted mb-4">Liste des RDV</h6>
                            </div>
                        </div>
                            {% set appointments_counter = 0 %}
                            {% for appointment in client_appointments_list %}
                        <div class="pl-lg-4">


                                <input type="text" name="{{ appointment.id }}" hidden>
                                {% set appointments_counter = appointments_counter + 1 %}
                                <h3 class="heading-small text-muted mb-4">RDV {{ appointments_counter }}</h3>
                                <div class="row">
                                    <div class="col-lg-3">
                                        <div class="form-group">
                                            <label class="form-control-label" for="input-city">Date et Heure de Début</label>
                                            <input type="datetime-local" class="form-control appointment_start{{ appointment.id }}" value="{{ appointment.start|date }}">
                                        </div>
                                    </div>

                                    <div class="col-lg-3">
                                        <div class="form-group">
                                            <label class="form-control-label" for="input-country">Date et Heure de Fin</label>
                                            <input type="datetime-local" id="input-country" class="form-control appointment_end{{ appointment.id }}" value="{{ appointment.end|date }}">
                                        </div>
                                    </div>

                                    <div class="col-lg-3">
                                        <div class="form-group">
                                            <label class="form-control-label" for="input-city">Commercial Affecté</label>
                                            {#<input type="text" id="input-city" class="form-control" value="{{ appointment.user.firstName ~ ' ' ~ appointment.user.lastName }}">#}
                                            <select name="assigned_commercial" id="assigned_commercial" class="form-control appointment_commercial{{ appointment.id }}">
                                                <option value="">Choisir...</option>
                                                {% for commercial in commercials %}
                                                    <option value="{{ commercial.id }}">{{ commercial.firstName ~ ' ' ~ commercial.lastName }}</option>
                                                {% endfor %}
                                            </select>
                                        </div>
                                    </div>

                                    <div class="col-lg-3">
                                        <div class="form-group">
                                            <label class="form-control-label" for="input-city">Etat</label>
                                            {#<input type="text" id="input-city" class="form-control" value="{% if appointment.isDone == 0 %}A Venir{% else %}Effectué{% endif %}">#}
                                            <select name="appointment_status" id="appointment_status" class="form-control appointment_status{{ appointment.id }}">
                                                <option value="" selected>Choisir...</option>
                                                <option value="0">A Venir</option>
                                                <option value="1">Effectué</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>


                                <div class="row">
                                    <div class="col-lg-12">
                                        <div class="form-group">
                                            <label class="form-control-label" for="input-city">Notes RDV</label>
                                            <textarea rows="4" class="form-control appointment_notes{{ appointment.id }}" placeholder="Pas de notes ..." resize="none">{{ appointment.appointmentNotes }}</textarea>
                                        </div>
                                    </div>

                                </div>
                                {#<div class="text-right">
                                    <button type="button" class="btn btn-sm btn-info">Editer RDV</button>
                                </div>#}
                                <hr class="my-4" />
                            {% endfor %}
                        </div>

                        {% endif %}
                    <div class="text-center">
                        <button type="submit" class="btn btn-success mt-4">Confirmer</button>
                    </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    {% endblock %}
